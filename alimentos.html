<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Alimentos - DMTool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Importação das bibliotecas do Firebase compat v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
  
  <style>
    /* Estilos gerais */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9fafb;
      display: flex;
      flex-direction: column;
    }

    /* Estilos do cabeçalho */
    header {
      background-color: #2563eb;
      color: white;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    header h1 {
      margin: 0;
      font-size: 24px;
      flex-grow: 1;
      text-align: right;
    }

    #menu-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 30px;
      cursor: pointer;
      margin-right: 10px;
    }

    /* Estilos da barra lateral (sidebar) - Agora com largura fixa */
    .sidebar {
      position: fixed;
      top: 0;
      left: -250px; /* Esconde o menu com largura fixa */
      width: 250px; /* Largura fixa em todos os dispositivos */
      height: 100%;
      background-color: #2e3a51;
      color: white;
      padding-top: 60px;
      transition: left 0.3s ease;
      z-index: 99;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
    }
    
    .sidebar.open {
      left: 0;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 98;
      display: none;
    }
    
    .sidebar a {
      display: block;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      border-bottom: 1px solid #4a5568;
      transition: background-color 0.2s;
    }

    .sidebar a:hover {
      background-color: #4a5568;
    }

    .sidebar h3 {
        padding: 0 20px;
        color: #ddd;
        font-weight: normal;
        font-size: 1rem;
        border-bottom: 1px solid #4a5568;
        padding-bottom: 15px;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow-y: auto;
    }

    .container {
      width: 100%;
      max-width: 600px;
    }

    h2 {
      text-align: center;
      color: #333;
      margin-top: 0;
      margin-bottom: 20px;
    }

    #searchBar {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 20px;
    }

    #addFoodButton {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #10b981;
      color: white;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .lista-alimentos-container {
      width: 100%;
      height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .alimento-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s, border-color 0.2s;
    }

    .alimento-item:hover {
      background-color: #f3f4f6;
    }

    .alimento-item.selected {
      background-color: #d1fae5;
      border-color: #10b981;
    }

    .alimento-nome {
      font-weight: bold;
      color: #333;
      flex-grow: 1;
    }

    /* Estilos do painel de detalhes e adicionar */
    .detalhes-alimento-panel, .adicionar-alimento-panel {
      position: fixed;
      top: 0;
      left: -50%;
      width: 50%; /* Metade da tela em desktop */
      height: 100%;
      background-color: white;
      z-index: 100;
      transform: translateX(0);
      transition: left 0.3s ease-in-out;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .detalhes-alimento-panel.open, .adicionar-alimento-panel.open {
      left: 0;
    }

    @media (max-width: 768px) {
      .detalhes-alimento-panel, .adicionar-alimento-panel {
        left: -100%;
        width: 100%; /* Tela inteira em mobile */
      }
    }

    .detalhes-alimento-panel h2, .adicionar-alimento-panel h2 {
      margin-top: 0;
    }

    .detalhes-alimento-panel label, .adicionar-alimento-panel label {
      margin-top: 15px;
      display: block;
      font-weight: bold;
      color: #555;
    }

    .detalhes-alimento-panel input, .adicionar-alimento-panel input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 16px;
    }
    
    .painel-botoes-detalhes, .painel-botoes-adicionar {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        justify-content: flex-end;
    }

    .btn-acao {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      transition: background-color 0.2s;
    }

    .btn-fechar {
        background-color: #9ca3af;
        color: white;
    }

    .btn-fechar:hover {
        background-color: #6b7280;
    }

    .btn-salvar-novo {
        background-color: #2563eb;
        color: white;
    }

    .btn-salvar-novo:hover {
        background-color: #1e40af;
    }

    .btn-excluir {
        background-color: #ef4444;
        color: white;
    }
    
    .btn-excluir:hover {
        background-color: #b91c1c;
    }

    .btn-editar, .btn-salvar-edicao {
        background-color: #f59e0b;
        color: white;
    }

    .btn-editar:hover, .btn-salvar-edicao:hover {
        background-color: #d97706;
    }

    /* Modal personalizado para alertas e confirmações */
    .custom-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 200;
      display: none;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .modal-content p {
      margin: 0 0 20px 0;
    }

    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .btn-retornar {
      background-color: #9ca3af;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-confirmar {
      background-color: #ef4444;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <header>
    <button id="menu-toggle" aria-label="Abrir Menu">
      <i class="fas fa-bars"></i>
    </button>
    <h1>DMTool</h1>
  </header>

  <nav id="sidebar" class="sidebar">
    <h3 id="userNameInMenu">Carregando...</h3>
    <a href="choEInsulina.html">Calcular refeição</a>
    <a href="ajustes.html">Ajustes</a>
    <a href="relatorios.html">Relatórios</a>
    <a href="meusDados.html">Meus dados</a>
    <a href="menu.html">Menu inicial</a>
    <a href="#" id="logoutLink">Sair</a>
  </nav>

  <div id="overlay" class="overlay"></div>

  <main>
    <div class="container">
      <h2>Alimentos</h2>
      <input type="text" id="searchBar" placeholder="Consultar alimentos..." />
      <button id="addFoodButton">Adicionar meus alimentos</button>
      <div id="foodList" class="lista-alimentos-container">
        <!-- Itens da lista de alimentos serão inseridos aqui -->
      </div>
    </div>
  </main>

  <!-- Painel deslizante de detalhes do alimento -->
  <div id="foodDetailsPanel" class="detalhes-alimento-panel">
    <div style="flex: 1;">
      <h2>Detalhes do Alimento</h2>
      <div id="detailsContent">
        <label for="detailNome">Nome</label>
        <input type="text" id="detailNome" disabled />
        
        <label for="detailMedida">Medida ou porção</label>
        <input type="text" id="detailMedida" disabled />
        
        <label for="detailPeso">Peso da medida ou porção (g/ml)</label>
        <input type="number" id="detailPeso" disabled />
        
        <label for="detailCarboidrato">Carboidrato (g)</label>
        <input type="number" id="detailCarboidrato" disabled />
        
        <label for="detailProteina">Proteína (g)</label>
        <input type="number" id="detailProteina" disabled />

        <label for="detailEnergia">Quilocaloria (kcal)</label>
        <input type="number" id="detailEnergia" disabled />
        
        <label for="detailGordura">Gordura (g)</label>
        <input type="number" id="detailGordura" disabled />
      </div>
    </div>
    
    <div class="painel-botoes-detalhes">
      <button id="btnFecharDetalhes" class="btn-acao btn-fechar">Fechar</button>
      <button id="btnEditar" class="btn-acao btn-editar">Editar</button>
      <button id="btnSalvarEdicao" class="btn-acao btn-salvar-edicao" style="display: none;">Salvar</button>
      <button id="btnExcluir" class="btn-acao btn-excluir">Excluir</button>
    </div>
  </div>

  <!-- Painel deslizante para adicionar novo alimento -->
  <div id="addFoodPanel" class="adicionar-alimento-panel">
    <div style="flex: 1;">
      <h2>Adicionar Meu Alimento</h2>
      <div id="addFoodContent">
        <label for="addNome">Nome do Alimento</label>
        <input type="text" id="addNome" />
        
        <label for="addMedida">Medida ou porção</label>
        <input type="text" id="addMedida" />
        
        <label for="addPeso">Peso da medida ou porção (g/ml)</label>
        <input type="number" id="addPeso" />
        
        <label for="addCarboidrato">Carboidrato (g)</label>
        <input type="number" id="addCarboidrato" />
        
        <label for="addProteina">Proteína (g)</label>
        <input type="number" id="addProteina" />
        
        <label for="addEnergia">Quilocaloria (kcal)</label>
        <input type="number" id="addEnergia" />
        
        <label for="addGordura">Gordura (g)</label>
        <input type="number" id="addGordura" />
      </div>
    </div>

    <div class="painel-botoes-adicionar">
      <button id="btnCancelar" class="btn-acao btn-fechar">Cancelar</button>
      <button id="btnGravar" class="btn-acao btn-salvar-novo">Gravar</button>
    </div>
  </div>

  <!-- Modal personalizado para alertas e confirmações -->
  <div id="customModal" class="custom-modal">
    <div class="modal-content">
      <p id="modalMessage"></p>
      <div id="modalButtons" class="modal-buttons">
        <button id="modalBtnOk" class="btn-acao btn-salvar-novo">OK</button>
      </div>
    </div>
  </div>

  <script>
    // Configuração do Firebase com suas credenciais
    const firebaseConfig = {
      apiKey: "AIzaSyBjyWDtsSTa8Wb162xFujBt_q3KfKlOP98",
      authDomain: "dmtool-89d0d.firebaseapp.com",
      projectId: "dmtool-89d0d",
      storageBucket: "dmtool-89d0d.firebasestorage.app",
      messagingSenderId: "389362217807",
      appId: "1:389362217807:web:2805220ee73ce3c0c28b3a"
    };

    // Inicializa o Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menu-toggle');
    const overlay = document.getElementById('overlay');
    const userNameInMenu = document.getElementById('userNameInMenu');
    const searchBar = document.getElementById('searchBar');
    const foodListContainer = document.getElementById('foodList');
    const addFoodButton = document.getElementById('addFoodButton');
    const foodDetailsPanel = document.getElementById('foodDetailsPanel');
    const addFoodPanel = document.getElementById('addFoodPanel');
    const btnFecharDetalhes = document.getElementById('btnFecharDetalhes');
    const btnCancelar = document.getElementById('btnCancelar');
    const btnGravar = document.getElementById('btnGravar');
    const btnEditar = document.getElementById('btnEditar');
    const btnSalvarEdicao = document.getElementById('btnSalvarEdicao');
    const btnExcluir = document.getElementById('btnExcluir');
    const customModal = document.getElementById('customModal');
    const modalMessage = document.getElementById('modalMessage');
    const modalButtons = document.getElementById('modalButtons');
    const logoutLink = document.getElementById('logoutLink');

    let currentUserUid = null;
    let selectedFood = null;

    // Monitora o estado de autenticação para obter o UID e nome do usuário
    auth.onAuthStateChanged(async user => {
      if (user) {
        currentUserUid = user.uid;
        try {
          const doc = await db.collection('usuarios').doc(currentUserUid).get();
          if (doc.exists) {
            const usuario = doc.data();
            userNameInMenu.innerText = usuario.nome || "Usuário";
          }
        } catch (error) {
          console.error("Erro ao buscar dados do usuário:", error);
          userNameInMenu.innerText = "Usuário";
        }
        loadFoods();
      } else {
        currentUserUid = null;
        window.location.href = "./login/login.html";
      }
    });

    // Funções para o modal personalizado
    function showModal(message, isConfirmation, onConfirm) {
        modalMessage.innerText = message;
        modalButtons.innerHTML = '';
        if (isConfirmation) {
            const btnCancel = document.createElement('button');
            btnCancel.classList.add('btn-acao', 'btn-retornar');
            btnCancel.innerText = 'Cancelar';
            btnCancel.addEventListener('click', () => customModal.style.display = 'none');
            modalButtons.appendChild(btnCancel);
            
            const btnConfirm = document.createElement('button');
            btnConfirm.classList.add('btn-acao', 'btn-excluir');
            btnConfirm.innerText = 'Excluir';
            btnConfirm.addEventListener('click', () => {
                onConfirm();
                customModal.style.display = 'none';
            });
            modalButtons.appendChild(btnConfirm);
        } else {
            const btnOk = document.createElement('button');
            btnOk.classList.add('btn-acao', 'btn-salvar-novo');
            btnOk.innerText = 'OK';
            btnOk.addEventListener('click', () => customModal.style.display = 'none');
            modalButtons.appendChild(btnOk);
        }
        customModal.style.display = 'flex';
    }

    // Funções de manipulação do menu sanduíche
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      overlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
    });

    overlay.addEventListener('click', () => {
      sidebar.classList.remove('open');
      overlay.style.display = 'none';
    });

    // Evento de clique para o link "Sair" do menu
    logoutLink.addEventListener('click', (e) => {
      e.preventDefault();
      showModal("Tem certeza de que deseja sair?", true, async () => {
        try {
          await auth.signOut();
          window.location.href = "./login/login.html";
        } catch (error) {
          console.error("Erro ao fazer logout:", error);
          showModal("Erro ao tentar sair: " + error.message, false);
        }
      });
    });

    // Função para buscar e exibir alimentos
    async function loadFoods() {
      if (!currentUserUid) return;

      const alimentosRef = db.collection('alimentos');
      const meusAlimentosRef = db.collection('meusAlimentos').where('uid', '==', currentUserUid);

      const [alimentosSnapshot, meusAlimentosSnapshot] = await Promise.all([
        alimentosRef.get(),
        meusAlimentosRef.get()
      ]);

      const alimentos = alimentosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), isUserFood: false }));
      const meusAlimentos = meusAlimentosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), isUserFood: true }));

      const allFoods = [...alimentos, ...meusAlimentos];
      renderFoods(allFoods);
    }

    // Função para renderizar os botões de alimentos
    function renderFoods(foods) {
      foodListContainer.innerHTML = '';
      foods.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(food => {
        const item = document.createElement('div');
        item.classList.add('alimento-item');
        item.dataset.id = food.id;
        item.dataset.isUserFood = food.isUserFood;
        item.innerHTML = `<span class="alimento-nome">${food.nome}</span>`;
        foodListContainer.appendChild(item);
      });
    }

    // Função de filtro da barra de pesquisa
    searchBar.addEventListener('input', async (e) => {
      const searchTerm = e.target.value.toLowerCase();
      
      const allFoods = await getAllFoods();
      const filteredFoods = allFoods.filter(food => food.nome.toLowerCase().includes(searchTerm));
      
      renderFoods(filteredFoods);
    });

    async function getAllFoods() {
      if (!currentUserUid) return [];
      const alimentosRef = db.collection('alimentos');
      const meusAlimentosRef = db.collection('meusAlimentos').where('uid', '==', currentUserUid);

      const [alimentosSnapshot, meusAlimentosSnapshot] = await Promise.all([
        alimentosRef.get(),
        meusAlimentosRef.get()
      ]);

      const alimentos = alimentosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), isUserFood: false }));
      const meusAlimentos = meusAlimentosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), isUserFood: true }));
      
      return [...alimentos, ...meusAlimentos];
    }

    // Manipula o clique nos itens da lista
    foodListContainer.addEventListener('click', async (e) => {
      const item = e.target.closest('.alimento-item');
      if (!item) return;

      document.querySelectorAll('.alimento-item').forEach(i => i.classList.remove('selected'));
      item.classList.add('selected');

      const isUserFood = item.dataset.isUserFood === 'true';
      selectedFood = await getFoodById(item.dataset.id, isUserFood);
      
      showFoodDetails(selectedFood);
    });

    // Função para obter alimento por ID
    async function getFoodById(id, isUserFood) {
        let docRef;
        if (isUserFood) {
            docRef = db.collection('meusAlimentos').doc(id);
        } else {
            docRef = db.collection('alimentos').doc(id);
        }
        const doc = await docRef.get();
        if (doc.exists) {
            return { id: doc.id, ...doc.data(), isUserFood: isUserFood };
        }
        return null;
    }

    function showFoodDetails(food) {
        if (!food) return;

        document.getElementById('detailNome').value = food.nome || '';
        document.getElementById('detailMedida').value = food.medida_caseira || '';
        document.getElementById('detailPeso').value = food.quantidade_g_ml || '';
        document.getElementById('detailCarboidrato').value = food.carboidrato || '';
        document.getElementById('detailProteina').value = food.proteina || '';
        document.getElementById('detailEnergia').value = food.energia || '';
        document.getElementById('detailGordura').value = food.gordura || '';

        // Oculta os botões por padrão
        btnEditar.style.display = 'none';
        btnSalvarEdicao.style.display = 'none';
        btnExcluir.style.display = 'none';
        
        // Exibe os botões se for um alimento do usuário
        if (food.isUserFood) {
            btnEditar.style.display = 'inline-block';
            btnExcluir.style.display = 'inline-block';
        }

        disableDetailsFields();
        foodDetailsPanel.classList.add('open');
    }

    // Função para habilitar/desabilitar os campos de edição
    function enableDetailsFields() {
      document.getElementById('detailNome').disabled = false;
      document.getElementById('detailMedida').disabled = false;
      document.getElementById('detailPeso').disabled = false;
      document.getElementById('detailCarboidrato').disabled = false;
      document.getElementById('detailProteina').disabled = false;
      document.getElementById('detailEnergia').disabled = false;
      document.getElementById('detailGordura').disabled = false;
    }

    function disableDetailsFields() {
      document.getElementById('detailNome').disabled = true;
      document.getElementById('detailMedida').disabled = true;
      document.getElementById('detailPeso').disabled = true;
      document.getElementById('detailCarboidrato').disabled = true;
      document.getElementById('detailProteina').disabled = true;
      document.getElementById('detailEnergia').disabled = true;
      document.getElementById('detailGordura').disabled = true;
    }

    // Botão de editar
    btnEditar.addEventListener('click', () => {
        enableDetailsFields();
        btnEditar.style.display = 'none';
        btnSalvarEdicao.style.display = 'inline-block';
    });

    // Botão de salvar edição
    btnSalvarEdicao.addEventListener('click', async () => {
        if (!selectedFood || !selectedFood.isUserFood) return;
        const updatedFood = {
            nome: document.getElementById('detailNome').value,
            medida_caseira: document.getElementById('detailMedida').value,
            quantidade_g_ml: parseFloat(document.getElementById('detailPeso').value) || 0,
            carboidrato: parseFloat(document.getElementById('detailCarboidrato').value) || 0,
            proteina: parseFloat(document.getElementById('detailProteina').value) || 0,
            energia: parseFloat(document.getElementById('detailEnergia').value) || 0,
            gordura: parseFloat(document.getElementById('detailGordura').value) || 0
        };

        try {
            await db.collection('meusAlimentos').doc(selectedFood.id).update(updatedFood);
            showModal('Alimento atualizado com sucesso!', false);
            foodDetailsPanel.classList.remove('open');
            loadFoods();
        } catch (error) {
            showModal('Erro ao atualizar o alimento: ' + error.message, false);
        }
    });

    // Botão de excluir
    btnExcluir.addEventListener('click', () => {
        if (!selectedFood || !selectedFood.isUserFood) return;
        showModal(`Tem certeza que deseja excluir o alimento "${selectedFood.nome}"?`, true, async () => {
            try {
                await db.collection('meusAlimentos').doc(selectedFood.id).delete();
                showModal('Alimento excluído com sucesso!', false);
                foodDetailsPanel.classList.remove('open');
                loadFoods();
            } catch (error) {
                showModal('Erro ao excluir o alimento: ' + error.message, false);
            }
        });
    });

    // Botão de fechar detalhes
    btnFecharDetalhes.addEventListener('click', () => {
      foodDetailsPanel.classList.remove('open');
    });

    // Fechar o painel de detalhes se clicar fora
    document.addEventListener('click', (e) => {
        if (foodDetailsPanel.classList.contains('open') && !foodDetailsPanel.contains(e.target) && !e.target.closest('.alimento-item')) {
            foodDetailsPanel.classList.remove('open');
        }
    });

    // Abrir o painel para adicionar novo alimento
    addFoodButton.addEventListener('click', () => {
      addFoodPanel.classList.add('open');
    });

    // Fechar o painel de adicionar novo alimento
    btnCancelar.addEventListener('click', () => {
      addFoodPanel.classList.remove('open');
      // Limpar campos
      document.getElementById('addFoodContent').querySelectorAll('input').forEach(input => input.value = '');
    });

    // Fechar o painel de adicionar se clicar fora
    document.addEventListener('click', (e) => {
        if (addFoodPanel.classList.contains('open') && !addFoodPanel.contains(e.target) && e.target !== addFoodButton) {
            addFoodPanel.classList.remove('open');
        }
    });

    // Gravar novo alimento
    btnGravar.addEventListener('click', async () => {
      if (!currentUserUid) {
        showModal("Usuário não autenticado. Faça login novamente.", false);
        return;
      }

      const newFood = {
        uid: currentUserUid,
        nome: document.getElementById('addNome').value,
        medida_caseira: document.getElementById('addMedida').value,
        quantidade_g_ml: parseFloat(document.getElementById('addPeso').value) || 0,
        carboidrato: parseFloat(document.getElementById('addCarboidrato').value) || 0,
        proteina: parseFloat(document.getElementById('addProteina').value) || 0,
        energia: parseFloat(document.getElementById('addEnergia').value) || 0,
        gordura: parseFloat(document.getElementById('addGordura').value) || 0
      };

      if (!newFood.nome || !newFood.medida_caseira) {
        showModal("Nome e medida são campos obrigatórios.", false);
        return;
      }

      try {
        await db.collection('meusAlimentos').add(newFood);
        showModal('Alimento adicionado com sucesso!', false);
        addFoodPanel.classList.remove('open');
        // Limpar campos
        document.getElementById('addFoodContent').querySelectorAll('input').forEach(input => input.value = '');
        loadFoods();
      } catch (error) {
        showModal('Erro ao adicionar o alimento: ' + error.message, false);
      }
    });
  </script>
</body>
</html>
